# ğŸ—ï¸ ResiFlow Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  React Frontend (TypeScript + Vite)                    â”‚    â”‚
â”‚  â”‚  - Patient Management UI                                â”‚    â”‚
â”‚  â”‚  - AI Assistant Interface                               â”‚    â”‚
â”‚  â”‚  - Medication & Lab Tracking                           â”‚    â”‚
â”‚  â”‚  - Real-time Dashboard                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ HTTP/REST
                    â”‚ JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  API Client Service (apiClient.ts)                   â”‚       â”‚
â”‚  â”‚  - HTTP Request Management                            â”‚       â”‚
â”‚  â”‚  - JWT Token Handling                                 â”‚       â”‚
â”‚  â”‚  - Error Handling                                     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ REST API Calls
                    â”‚ Bearer Token Auth
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   â–¼         BACKEND SERVER                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Express.js API Server (Node.js + TypeScript)        â”‚       â”‚
â”‚  â”‚                                                       â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚  â”‚  â”‚  Middleware Layer                            â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Authentication (JWT Verify)               â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Authorization (RBAC)                      â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Validation (Input Sanitization)           â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Rate Limiting                              â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Audit Logging                              â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Error Handling                             â”‚    â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚  â”‚                   â–¼                                   â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚  â”‚  â”‚  Routes Layer                                â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  /api/auth     - Authentication              â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  /api/patients - Patient Management          â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  /api/tasks    - Task Operations             â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  /api/meds     - Medication Management       â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  /api/labs     - Lab Results                 â”‚    â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚  â”‚                   â–¼                                   â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚  â”‚  â”‚  Controllers Layer                           â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Business Logic                            â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Request Processing                        â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Response Formatting                       â”‚    â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚  â”‚                   â–¼                                   â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚  â”‚  â”‚  Services Layer                              â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Gemini AI Integration                     â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Data Encryption/Decryption                â”‚    â”‚       â”‚
â”‚  â”‚  â”‚  - Business Rules                            â”‚    â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Mongoose ODM
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  MongoDB (NoSQL Database)                            â”‚       â”‚
â”‚  â”‚                                                       â”‚       â”‚
â”‚  â”‚  Collections:                                         â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚  â”‚  â”‚  users                                        â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - Authentication credentials                 â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - User profiles & roles                     â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - PIN verification                           â”‚   â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚  â”‚  â”‚  patients                                     â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - Patient demographics                       â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - Medical records                            â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - Medications & labs                         â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - Tasks & timeline                           â”‚   â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚  â”‚  â”‚  auditlogs                                    â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - User actions                               â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - Timestamps                                 â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  - Resource changes                           â”‚   â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SERVICES                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Google Gemini AI API                                â”‚       â”‚
â”‚  â”‚  - Clinical summaries                                 â”‚       â”‚
â”‚  â”‚  - Drug interactions                                  â”‚       â”‚
â”‚  â”‚  - Lab interpretation                                â”‚       â”‚
â”‚  â”‚  - Discharge summaries                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Authentication Flow
```
User Login Request
    â†“
[Frontend] apiClient.login(email, password)
    â†“ HTTP POST /api/auth/login
[Backend] authController.login()
    â†“ Find user in database
[MongoDB] users.findOne({ email })
    â†“ Verify password (bcrypt)
[Backend] user.comparePassword()
    â†“ Generate JWT token
[Backend] jwt.sign({ userId })
    â†“ Return token + user info
[Frontend] Store token in localStorage
    â†“
All subsequent requests include:
Authorization: Bearer <token>
```

### Patient CRUD Flow
```
Get All Patients
    â†“
[Frontend] apiClient.getAllPatients()
    â†“ HTTP GET /api/patients
    â†“ Authorization: Bearer <token>
[Backend] authenticate middleware
    â†“ Verify JWT token
[Backend] patientController.getAllPatients()
    â†“ Query database
[MongoDB] patients.find()
    â†“ Return patient array
[Backend] Send JSON response
    â†“
[Frontend] Update state with patients
```

### AI Integration Flow
```
Generate Pre-round Summary
    â†“
[Frontend] Request summary for patient
    â†“ HTTP POST /api/patients/:id/summary
[Backend] Anonymize patient data
    â†“
[Backend] geminiService.generatePreRoundSummary()
    â†“ Call Gemini API
[Gemini AI] Process medical data
    â†“ Generate SOAP notes
[Backend] Return summary
    â†“
[Frontend] Display in UI
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Transport Security        â”‚
â”‚  - HTTPS/TLS encryption             â”‚
â”‚  - Secure headers (Helmet.js)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: Authentication            â”‚
â”‚  - JWT token verification           â”‚
â”‚  - Token expiration (7 days)        â”‚
â”‚  - Secure token storage             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Authorization             â”‚
â”‚  - Role-based access control        â”‚
â”‚  - Admin/Attending/Resident/Nurse   â”‚
â”‚  - Endpoint-level permissions       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: Input Validation          â”‚
â”‚  - express-validator                â”‚
â”‚  - Request sanitization             â”‚
â”‚  - Type checking                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 5: Rate Limiting             â”‚
â”‚  - Per-IP request limits            â”‚
â”‚  - Brute force protection           â”‚
â”‚  - Account lockout                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 6: Data Encryption           â”‚
â”‚  - AES-256-CBC for sensitive data   â”‚
â”‚  - bcrypt for passwords (10 rounds) â”‚
â”‚  - Encrypted fields in database     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 7: Audit Logging             â”‚
â”‚  - All actions logged               â”‚
â”‚  - Immutable audit trail            â”‚
â”‚  - HIPAA compliance                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack

### Frontend Stack
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React 19              â”‚  UI Library
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TypeScript            â”‚  Type Safety
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vite                  â”‚  Build Tool
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Lucide React          â”‚  Icons
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Recharts              â”‚  Visualizations
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Framer Motion         â”‚  Animations
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend Stack
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Node.js 18+           â”‚  Runtime
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Express.js            â”‚  Web Framework
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TypeScript            â”‚  Type Safety
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MongoDB + Mongoose    â”‚  Database
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  JWT                   â”‚  Auth
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  bcryptjs              â”‚  Hashing
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Winston               â”‚  Logging
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Helmet + CORS         â”‚  Security
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture

### Development
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  localhost:5173  â”‚ â†â”€â”€â†’ â”‚  localhost:5000  â”‚
â”‚  Frontend Dev    â”‚      â”‚  Backend Dev     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Local MongoDB   â”‚
                          â”‚  localhost:27017 â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel/Netlify      â”‚      â”‚  Heroku/Railway      â”‚
â”‚  CDN + Static Files  â”‚ â†â”€â”€â†’ â”‚  API Server          â”‚
â”‚  (Frontend)          â”‚      â”‚  (Backend)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  MongoDB Atlas       â”‚
                              â”‚  Cloud Database      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API Endpoints Structure

```
/api
â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ POST   /register      (Register new user)
â”‚   â”œâ”€â”€ POST   /login         (User login)
â”‚   â”œâ”€â”€ GET    /profile       (Get profile) ğŸ”
â”‚   â”œâ”€â”€ PUT    /profile       (Update profile) ğŸ”
â”‚   â”œâ”€â”€ POST   /verify-pin    (Verify PIN) ğŸ”
â”‚   â”œâ”€â”€ POST   /set-pin       (Set PIN) ğŸ”
â”‚   â””â”€â”€ GET    /users         (List users) ğŸ”ğŸ‘‘
â”‚
â”œâ”€â”€ /patients
â”‚   â”œâ”€â”€ GET    /              (List patients) ğŸ”
â”‚   â”œâ”€â”€ GET    /statistics    (Get stats) ğŸ”
â”‚   â”œâ”€â”€ GET    /:id           (Get patient) ğŸ”
â”‚   â”œâ”€â”€ POST   /              (Create patient) ğŸ”
â”‚   â”œâ”€â”€ PUT    /:id           (Update patient) ğŸ”
â”‚   â”œâ”€â”€ DELETE /:id           (Delete patient) ğŸ”ğŸ‘‘
â”‚   â”‚
â”‚   â”œâ”€â”€ /tasks
â”‚   â”‚   â”œâ”€â”€ POST   /:patientId/tasks          ğŸ”
â”‚   â”‚   â”œâ”€â”€ PUT    /:patientId/tasks/:taskId  ğŸ”
â”‚   â”‚   â””â”€â”€ DELETE /:patientId/tasks/:taskId  ğŸ”
â”‚   â”‚
â”‚   â”œâ”€â”€ /medications
â”‚   â”‚   â”œâ”€â”€ POST   /:patientId/medications              ğŸ”
â”‚   â”‚   â””â”€â”€ PUT    /:patientId/medications/:medId       ğŸ”
â”‚   â”‚
â”‚   â””â”€â”€ /labs
â”‚       â””â”€â”€ POST   /:patientId/labs                     ğŸ”

Legend:
ğŸ” = Authentication Required
ğŸ‘‘ = Admin/Attending Only
```

## File Structure

```
resiflow-ai/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ components/           # React components
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ apiClient.ts     # Backend API client
â”‚   â”‚   â”œâ”€â”€ geminiService.ts # AI integration
â”‚   â”‚   â””â”€â”€ secureDatabase.ts # (Legacy - local storage)
â”‚   â”œâ”€â”€ types.ts             # TypeScript types
â”‚   â”œâ”€â”€ App.tsx              # Main app component
â”‚   â””â”€â”€ index.tsx            # Entry point
â”‚
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ config/          # Configuration
â”‚       â”‚   â”œâ”€â”€ index.ts
â”‚       â”‚   â”œâ”€â”€ database.ts
â”‚       â”‚   â””â”€â”€ logger.ts
â”‚       â”œâ”€â”€ controllers/     # Request handlers
â”‚       â”‚   â”œâ”€â”€ authController.ts
â”‚       â”‚   â””â”€â”€ patientController.ts
â”‚       â”œâ”€â”€ middleware/      # Express middleware
â”‚       â”‚   â”œâ”€â”€ auth.ts
â”‚       â”‚   â”œâ”€â”€ audit.ts
â”‚       â”‚   â”œâ”€â”€ errorHandler.ts
â”‚       â”‚   â””â”€â”€ validation.ts
â”‚       â”œâ”€â”€ models/          # Mongoose schemas
â”‚       â”‚   â”œâ”€â”€ User.ts
â”‚       â”‚   â”œâ”€â”€ Patient.ts
â”‚       â”‚   â””â”€â”€ AuditLog.ts
â”‚       â”œâ”€â”€ routes/          # API routes
â”‚       â”‚   â”œâ”€â”€ auth.ts
â”‚       â”‚   â””â”€â”€ patients.ts
â”‚       â”œâ”€â”€ services/        # Business logic
â”‚       â”‚   â””â”€â”€ geminiService.ts
â”‚       â”œâ”€â”€ utils/           # Utilities
â”‚       â”‚   â””â”€â”€ encryption.ts
â”‚       â””â”€â”€ index.ts         # Server entry point
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ QUICKSTART.md
    â”œâ”€â”€ BACKEND_SUMMARY.md
    â”œâ”€â”€ INTEGRATION_GUIDE.md
    â””â”€â”€ ARCHITECTURE.md (this file)
```

## State Management Flow

```
User Action
    â†“
Component Handler
    â†“
API Client Call
    â†“
Backend Processing
    â†“
Database Update
    â†“
Response to Frontend
    â†“
State Update (useState/useEffect)
    â†“
UI Re-render
```

## Error Handling Flow

```
Error Occurs
    â†“
Try-Catch in Component
    â†“
Check Error Type
    â”‚
    â”œâ”€â”€ Authentication Error â†’ Redirect to Login
    â”œâ”€â”€ Validation Error â†’ Show Field Errors
    â”œâ”€â”€ Network Error â†’ Show Retry Button
    â””â”€â”€ Server Error â†’ Show Error Message
```

---

This architecture provides:
âœ… Scalability
âœ… Security
âœ… Maintainability
âœ… Separation of Concerns
âœ… Type Safety
âœ… HIPAA Compliance
